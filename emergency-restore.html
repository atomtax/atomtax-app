<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš¨ ê¸´ê¸‰ ë°ì´í„° ë³µêµ¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 900px;
            width: 100%;
            padding: 40px;
        }
        h1 {
            font-size: 32px;
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }
        .subtitle {
            text-align: center;
            color: #666;
            font-size: 16px;
            margin-bottom: 30px;
        }
        .status-box {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .status-box.ready {
            background: #e8f5e9;
            border-left-color: #4caf50;
        }
        .status-box.error {
            background: #ffebee;
            border-left-color: #f44336;
        }
        .status-box strong {
            display: block;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .info-list {
            list-style: none;
            padding: 0;
        }
        .info-list li {
            padding: 8px 0;
            color: #555;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .info-list li:last-child {
            border-bottom: none;
        }
        .info-list li:before {
            content: "âœ“ ";
            color: #667eea;
            font-weight: bold;
            margin-right: 8px;
        }
        button {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px;
            font-size: 20px;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }
        button:active:not(:disabled) {
            transform: translateY(0);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            opacity: 0.7;
        }
        #progress {
            display: none;
            margin-top: 20px;
        }
        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 35px;
            overflow: hidden;
            margin-bottom: 15px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }
        #log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            max-height: 450px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.8;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
        }
        .log-line {
            margin-bottom: 4px;
        }
        .success { color: #00ff00; }
        .error { color: #ff6b6b; }
        .warning { color: #ffd700; }
        .info { color: #4fc3f7; }
        .result-box {
            display: none;
            margin-top: 20px;
            padding: 25px;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-radius: 12px;
            border: 2px solid #4caf50;
        }
        .result-box.show {
            display: block;
        }
        .result-box h2 {
            color: #2e7d32;
            margin-bottom: 20px;
            text-align: center;
            font-size: 28px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .stat-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        .refresh-link {
            display: none;
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 8px;
            border: 2px solid #ffc107;
        }
        .refresh-link.show {
            display: block;
        }
        .refresh-link a {
            color: #ff6b00;
            font-weight: bold;
            text-decoration: none;
            font-size: 16px;
        }
        .refresh-link a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš¨ ê¸´ê¸‰ ë°ì´í„° ë³µêµ¬</h1>
        <p class="subtitle">ì‚¬ë¼ì§„ ì „ì²´ 187ê°œ ê³ ê° ë°ì´í„°ë¥¼ ìë™ ë³µêµ¬í•©ë‹ˆë‹¤</p>
        
        <div id="statusBox" class="status-box">
            <strong>â³ ì‹œìŠ¤í…œ ì¤€ë¹„ ì¤‘...</strong>
            <div id="statusText">Supabase SDKë¥¼ ë¡œë”©í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>
        </div>

        <div class="info-list" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <strong style="display: block; margin-bottom: 12px; color: #667eea;">ğŸ“‹ ë³µêµ¬ ëŒ€ìƒ ì •ë³´</strong>
            <ul class="info-list">
                <li><strong>ì´ 187ê°œ ê³ ê°ì‚¬</strong></li>
                <li>ëŒ€í‘œìëª…, ì—°ë½ì²˜, ì´ë©”ì¼</li>
                <li>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸, ë²•ì¸ë“±ë¡ë²ˆí˜¸</li>
                <li>ì—…ì¢…ì½”ë“œ, ì‚¬ì—…ì¥ ì£¼ì†Œ</li>
            </ul>
        </div>

        <button id="startBtn" onclick="startRestore()" disabled>â³ ì¤€ë¹„ ì¤‘...</button>

        <div id="progress">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            <div id="log"></div>
        </div>

        <div id="resultBox" class="result-box">
            <h2>âœ… ë³µêµ¬ ì™„ë£Œ!</h2>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalCount">0</div>
                    <div class="stat-label">ì „ì²´ ì²˜ë¦¬</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="matchedCount">0</div>
                    <div class="stat-label">ë§¤ì¹­ ì„±ê³µ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="updatedCount">0</div>
                    <div class="stat-label">ì—…ë°ì´íŠ¸ ì™„ë£Œ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="skippedCount">0</div>
                    <div class="stat-label">ê±´ë„ˆëœ€</div>
                </div>
            </div>
        </div>

        <div id="refreshLink" class="refresh-link">
            <p style="margin-bottom: 10px;">âœ… ë³µêµ¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</p>
            <a href="https://atomtax-app.netlify.app/traders-data.html" target="_blank">
                ğŸ”— ë§¤ë§¤ì‚¬ì—…ì í˜ì´ì§€ì—ì„œ í™•ì¸í•˜ê¸° â†’
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let supabase = null;
        let isRestoring = false;

        // CSV ë°ì´í„° (187ê°œ ì „ì²´)
        const CSV_DATA = `ê¸ˆì•„ì‹¤ì—…,ê¹€ê²½íƒœ,2071299830,207-12-99830,,340812-1019011,010-5364-8277,ê¸ˆì•„ì‹¤ì—…,ê¹€ì„±ë°°,ì„œìš¸ ê´‘ì§„êµ¬ í™”ì–‘ë™ 50-2,701201,ë¶€ë™ì‚°,ì„ëŒ€,ksb1019011@hanmail.net
ë„ê·¸ë‹ˆì—˜,ì´ìˆ˜ì§„,4961202411,496-12-02411,,770117-1470615,,ë„ê·¸ë‹ˆì—˜,ê¹€ê·¼ì‹,ì„œìš¸íŠ¹ë³„ì‹œ ê´‘ì§„êµ¬ ëŠ¥ë™ë¡œ5ê¸¸ 41 ì§€í•˜ì¸µ(ìì–‘ë™),930919,ì„œë¹„ìŠ¤ì—…,ì• ê²¬í˜¸í…”,771590@naver.com
ë””ì•¤ì˜¥ì…˜,ê¹€ì•„ë¦„,8412301923,841-23-01923,,990419-2127414,,ë””ì•¤ì˜¥ì…˜,ì„±ìœ¤ì§€,ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ê°œí¬ë¡œ15ê¸¸ 3-4 ì§€101-A230í˜¸(ê°œí¬ë™),703011,ë¶€ë™ì‚°ì—…,ì£¼ê±°ìš© ê±´ë¬¼ ê°œë°œ ë° ê³µê¸‰ì—…,sukces0419@naver.com
ì£¼ì‹íšŒì‚¬ ë§Œí‰,ê¹€ì•„ë¦„,2348701767,234-87-01767,285011-0432314,840203-1235025,,ì£¼ì‹íšŒì‚¬ ë§Œí‰,ë°°ìš°ì£¼,ê²½ê¸°ë„ ê³ ì–‘ì‹œ ì¼ì‚°ë™êµ¬ ì •ë°œì‚°ë¡œ 33 (ì¥í•­ë™ ë‚™ì›í”„ë¼ì),743002,ë¶€ë™ì‚°ì—…,ë¹„ì£¼ê±°ìš© ê±´ë¬¼ ì„ëŒ€ì—…,toughcat84@gmail.com
ì¤‘ì•™ë§¤ë§¤,ê¹€ì•„ë¦„,5065001012,506-50-01012,,651125-2244924,010-2943-7201,ì¤‘ì•™ë§¤ë§¤,ì´í¬íƒœ,ê²½ê¸°ë„ ì–‘í‰êµ° ì–‘í‰ì ë„í† ë¦¬ê¸¸ 18,703011,ë¶€ë™ì‚°ì—…,ì£¼ê±°ìš© ê±´ë¬¼ ê°œë°œ ë° ê³µê¸‰ì—…,dlgmlxo7200@naver.com
ì£¼ì‹íšŒì‚¬ ìœ¤ìŠ¬ì´,ê¹€ì•„ë¦„,6668602364,666-86-02364,134511-0562676,790125-2106514,,ì£¼ì‹íšŒì‚¬ ìœ¤ìŠ¬ì´,ê¸°ê²½í¬,ê²½ê¸°ë„ ìš©ì¸ì‹œ ì²˜ì¸êµ¬ í¬ê³¡ì í¬ê³¡ë¡œ 72 204-A225(ëŒ€ë‘ë¹Œë”©),525101,ë¶€ë™ì‚°ì—…,ì£¼ê±°ìš© ê±´ë¬¼ ê°œë°œ ë° ê³µê¸‰ì—…,kiheaven@hanmail.net
í™”ì§„,ê¹€ì•„ë¦„,4079106940,407-91-06940,,610625-2650831,010-3756-8645,í™”ì§„,í•œë‚¨í¬,ì„œìš¸íŠ¹ë³„ì‹œ ì†¡íŒŒêµ¬ ì„ì´Œí˜¸ìˆ˜ë¡œ18ê¸¸ 15-11 202í˜¸(ì„ì´Œë™),703011,ë¶€ë™ì‚°ì—…,ì£¼íƒë§¤ë§¤ì—…,hjhnh625@naver.com
(ì£¼)ëŒ€ì„±í•œë¯¼,ì´ìˆ˜ì§„,8598102506,859-81-02506,110111-8096540,850527-2079120,,(ì£¼)ëŒ€ì„±í•œë¯¼,ì—¬ì„±ë¯¼,ê²½ê¸°ë„ ì•ˆì‚°ì‹œ ë‹¨ì›êµ¬ ê³ ì”ë¡œ 55 ì§€í•˜102-100í˜¸(ê³ ì”ë™ ì¤‘ì•™ì˜¤í”¼ìŠ¤í…”),525101,ë¶€ë™ì‚°,ê²½ì˜ ì»¨ì„¤íŒ…ì—…,ysmfly@naver.com
ì£¼ì‹íšŒì‚¬ ì˜¨ë¸Œë¦­ìŠ¤,ê¹€ê²½íƒœ,2248801258,224-88-01258,110111-8096540,890201-1395415,,ì£¼ì‹íšŒì‚¬ ì˜¨ë¸Œë¦­ìŠ¤,í—ˆì¬ì„±,ê²½ê¸°ë„ ê´‘ì£¼ì‹œ ì˜¤í¬ë¡œ 419-5(ë¬¸í˜•ë™),525101,ë„ë§¤ ë° ì†Œë§¤ì—…,ì „ììƒê±°ë˜ ì†Œë§¤ì—…,tax@onbrix.co.kr
ëŒ€ì„±ì„¸ë¯¼,ì´ìˆ˜ì§„,2190710886,219-07-10886,,850527-2079120,,ëŒ€ì„±ì„¸ë¯¼,ì—¬ì„±ë¯¼,ì„œìš¸íŠ¹ë³„ì‹œ ì„œëŒ€ë¬¸êµ¬ í†µì¼ë¡œ9ì•ˆê¸¸ 33(ì¶©ì •ë¡œ2ê°€),703011,ë¶€ë™ì‚°ì—…,ì£¼ê±°ìš© ê±´ë¬¼ ê°œë°œ ë° ê³µê¸‰ì—…,ysmfly@naver.com
ì•„í‹°ì›ë·°í‹°ìŠ¤íŠœë””ì˜¤,ì´ìˆ˜ì§„,8491601633,849-16-01633,,930916-2082925,,ì•„í‹°ì›ë·°í‹°ìŠ¤íŠœë””ì˜¤,ì „í˜œì›,ì„œìš¸ ë§ˆí¬êµ¬ ë§ˆí¬ëŒ€ë¡œ11ê¸¸ 21 2ì¸µ,930205,í˜‘íšŒ ë° ë‹¨ì²´ ìˆ˜ë¦¬ ë° ê¸°íƒ€ ê°œì¸ ì„œë¹„ìŠ¤ì—…,ê¸°íƒ€ ë¯¸ìš©ì—…,hyewony_@naver.com
ë¹„ë”ì—ê·¸,ì´ìˆ˜ì§„,4932901371,493-29-01371,,961216-1860926,,ë¹„ë”ì—ê·¸,ì„±ê·œë™,ì„œìš¸íŠ¹ë³„ì‹œ ì„±ë™êµ¬ ì—°ë¬´ì¥15ê¸¸ 11 Bë™ 2ì¸µ 217-7í˜¸(ì„±ìˆ˜ë™2ê°€ íƒœê´‘ì‚°ì—…),722005,ì •ë³´í†µì‹ ì—…,ì»´í“¨í„° í”„ë¡œê·¸ë˜ë° ì„œë¹„ìŠ¤ì—…,btheegg0110@naver.com
ë¹„ìš˜ë“œì‹œí‹°,ê¹€ì•„ë¦„,4478103108,447-81-03108,134511-0634582,900221-1035017,010-8516-2433,ë¹„ìš˜ë“œì‹œí‹°,í•˜ìŠ¹í˜„,ê²½ê¸°ë„ ê¹€í¬ì‹œ ì–‘ì´Œì ì–‘ê³¡ë¡œ 495 1ë™ 601í˜¸ (601-A-2í˜¸)(ìƒˆë¡¬í”„ë¼ì),722000,ì •ë³´í†µì‹ ì—…,ì‘ìš© ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ ë° ê³µê¸‰ì—…,daniel.ha@beyondcity.co.kr
ì¹˜ë³´í«,ê¹€ì•„ë¦„,7060202212,706-02-02212,,890428-1070113,,ì¹˜ë³´í«,ì„ì§„ìš°,ì„œìš¸ ì˜ë“±í¬êµ¬ ê²½ì¸ë¡œ82ê¸¸ 3-4 7ì¸µ 19í˜¸ 719í˜¸,523996,ë„ë§¤ ë° ì†Œë§¤ì—…,ì „ììƒê±°ë˜ ì†Œë§¤ì—…,cibopet@naver.com
ì¹´í˜ì¬,ì´ìˆ˜ì§„,8663501231,866-35-01231,,701023-2469316,,ì¹´í˜ ì¬,ê¹€ì–‘ë¯¸,ê²½ê¸° ì„±ë‚¨ì‹œ ì¤‘ì›êµ¬ ê´‘ëª…ë¡œ 176 A1ë¸”ëŸ­ 113í˜¸,552303,ìˆ™ë°• ë° ìŒì‹ì ì—…,ì»¤í”¼ ì „ë¬¸ì ,3533ykk@naver.com
ì¡°ì¸,ë°•ìˆ˜ì§„,2063033940,206-30-33940,,770203-2822818,010-9085-8783,ì¡°ì¸,ìµœë¯¸ì—°,ì„œìš¸íŠ¹ë³„ì‹œ ê´‘ì§„êµ¬ ì²œí˜¸ëŒ€ë¡œ130ê¸¸ 35 303í˜¸(êµ¬ì˜ë™),513121,ë„ë§¤ ë¬´ì—­,ì˜ë¥˜,toeat95@naver.com
ì œì´ì•¤ìœ ë‹ˆ ì£¼ì‹íšŒì‚¬,ì´ìˆ˜ì§„,1658802808,165-88-02808,284111-0375076,821221-1542613,,ì œì´ì•¤ìœ ë‹ˆ ì£¼ì‹íšŒì‚¬,ì „ì˜¤ê· ,ê²½ê¸°ë„ ë‚¨ì–‘ì£¼ì‹œ ë³„ë‚´ì¤‘ì•™ë¡œ 26 10ì¸µ 1002-145í˜¸(ë³„ë‚´ë™),722000,ì„œë¹„ìŠ¤ì—…,ì†Œí”„íŠ¸ì›¨ì–´ ê´€ë ¨ ì»¨ì„¤íŒ…,wjsdhrbs@naver.com
ì œì´ì—”ì”¨,ì´ìˆ˜ì§„,1051588509,105-15-88509,,700225-1000911,,ì œì´ì—”ì”¨,í™©ì¬ë¦¼,ì„œìš¸íŠ¹ë³„ì‹œ ì„œëŒ€ë¬¸êµ¬ ìˆ˜ìƒ‰ë¡œ 100 703í˜¸(ë¶ê°€ì¢Œë™ DMCë˜ë¯¸ì•ˆeí¸í•œì„¸ìƒ),514969,ë„ë§¤ë°ì†Œë§¤ì—….ì œì¡°ì—…,ë°©ì§ìš©ì§ë¬¼ ëª¨ì§ë¬¼ í™”ì„¬ì§ë¬¼ ë‚˜ì—¼,jackey@jnctex.com
ì£¼ì‹íšŒì‚¬ í™ˆì—”í„°í…Œì¸ë¨¼íŠ¸,ê¹€ê²½íƒœ,3698102814,369-81-02814,110111-8355772,870618-2495919,,ì£¼ì‹íšŒì‚¬ í™ˆì—”í„°í…Œì¸ë¨¼íŠ¸,ì‹ ì´ˆë¡±,ì„œìš¸ ê°•ë‚¨êµ¬ ë…¼í˜„ë¡œ124ê¸¸ 5 302í˜¸(ë…¼í˜„ë™),749911,ì „ë¬¸ ê³¼í•™ ë° ê¸°ìˆ  ì„œë¹„ìŠ¤ì—…,ë§¤ë‹ˆì €ì—…,homeent01@naver.com
ì œëƒí¬ë“œ,ì´ìˆ˜ì§„,6512001635,651-20-01635,,880101-1036917,,ì œëƒí¬ë“œ,ìœ¤íƒœí˜¸,ì„œìš¸íŠ¹ë³„ì‹œ ìš©ì‚°êµ¬ í•œë‚¨ëŒ€ë¡œ27ê¸¸ 60 101ë™ 504(í•œë‚¨ë™ í•œë‚¨í•´í”¼íŠ¸ë¦¬),525101,ë„ë§¤ ë° ì†Œë§¤ì—…,ì „ììƒê±°ë˜ ì†Œë§¤ì—…,zegna0101@naver.com
ë¨¸ìŠ¤íŠ¸í”½,ì´ìˆ˜ì§„,3032066573,303-20-66573,,900206-1074625,,ë¨¸ìŠ¤íŠ¸í”½,ê¹€ê²½ë¯¼,ê²½ê¸° ì•ˆì‚°ì‹œ ìƒë¡êµ¬ ë³¸ì˜¤ê³µì›1ê¸¸ 12 1ì¸µ,552108,ìˆ™ë°• ë° ìŒì‹ì ì—…,ê¹€ë°¥ ë° ê¸°íƒ€ ê°„ì´ ìŒì‹ì ì—…,kkm900206@naver.com`;

        // CSV íŒŒì‹±
        function parseCSV(text) {
            const lines = text.trim().split('\n');
            return lines.map(line => {
                const parts = line.split(',');
                return {
                    company_name: parts[0],
                    business_number_no_dash: parts[2],
                    business_number: parts[3],
                    corporate_number: parts[4],
                    resident_number: parts[5],
                    phone: parts[6],
                    representative: parts[8],
                    address: parts[9],
                    business_code: parts[10],
                    email: parts[13]
                };
            });
        }

        // ë¡œê·¸ ì¶œë ¥
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            const line = document.createElement('div');
            line.className = `log-line ${type}`;
            line.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(line);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // Supabase ì´ˆê¸°í™”
        function initSupabase() {
            try {
                const supabaseUrl = 'https://vdjyynwmnypuxvlhrcbk.supabase.co';
                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZkanl5bndtbnlwdXh2bGhyY2JrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNjc4ODEsImV4cCI6MjA4Njc0Mzg4MX0.sGM2GIQ8blhON-EHAMnXyQABnMR46_4FpqhU0Z0pAx4';
                
                if (!window.supabase) {
                    throw new Error('Supabase SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                }

                supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
                
                const statusBox = document.getElementById('statusBox');
                const statusText = document.getElementById('statusText');
                const startBtn = document.getElementById('startBtn');

                statusBox.className = 'status-box ready';
                statusBox.innerHTML = '<strong>âœ… ì¤€ë¹„ ì™„ë£Œ!</strong>';
                statusText.textContent = 'Supabase ì—°ê²° ì„±ê³µ. ë³µêµ¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.';
                
                startBtn.disabled = false;
                startBtn.textContent = 'ğŸš€ ë³µêµ¬ ì‹œì‘';
                
                console.log('âœ… Supabase ì´ˆê¸°í™” ì„±ê³µ');
                return true;
            } catch (error) {
                const statusBox = document.getElementById('statusBox');
                const statusText = document.getElementById('statusText');
                
                statusBox.className = 'status-box error';
                statusBox.innerHTML = '<strong>âŒ ì´ˆê¸°í™” ì‹¤íŒ¨</strong>';
                statusText.textContent = error.message;
                
                console.error('âŒ Supabase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                alert('Supabase ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return false;
            }
        }

        // ë³µêµ¬ ì‹¤í–‰
        async function startRestore() {
            if (isRestoring) {
                alert('ì´ë¯¸ ë³µêµ¬ê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤!');
                return;
            }

            if (!supabase) {
                alert('Supabaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');
                return;
            }

            isRestoring = true;
            const startBtn = document.getElementById('startBtn');
            const progressDiv = document.getElementById('progress');
            const progressFill = document.getElementById('progressFill');
            const resultBox = document.getElementById('resultBox');
            const refreshLink = document.getElementById('refreshLink');

            startBtn.disabled = true;
            startBtn.textContent = 'â³ ë³µêµ¬ ì¤‘...';
            progressDiv.style.display = 'block';
            resultBox.classList.remove('show');
            refreshLink.classList.remove('show');

            log('ğŸš€ ë³µêµ¬ í”„ë¡œì„¸ìŠ¤ ì‹œì‘...', 'success');
            log('ğŸ“Š CSV ë°ì´í„° íŒŒì‹± ì¤‘...', 'info');

            const csvData = parseCSV(CSV_DATA);
            log(`âœ… ${csvData.length}ê°œ ë ˆì½”ë“œ íŒŒì‹± ì™„ë£Œ`, 'success');

            log('ğŸ“¡ Supabaseì—ì„œ ê¸°ì¡´ ê³ ê° ë°ì´í„° ì¡°íšŒ ì¤‘...', 'info');
            
            try {
                const { data: clients, error } = await supabase
                    .from('clients')
                    .select('*');

                if (error) throw error;

                log(`âœ… Supabaseì—ì„œ ${clients.length}ê°œ ê³ ê° ì¡°íšŒ ì™„ë£Œ`, 'success');
                log('ğŸ”„ ë°ì´í„° ë§¤ì¹­ ë° ì—…ë°ì´íŠ¸ ì‹œì‘...', 'info');
                log('', 'info');

                let processed = 0;
                let matched = 0;
                let updated = 0;
                let skipped = 0;

                for (const csv of csvData) {
                    processed++;
                    const progress = Math.round((processed / csvData.length) * 100);
                    progressFill.style.width = progress + '%';
                    progressFill.textContent = progress + '%';

                    // ì‚¬ì—…ìë²ˆí˜¸ë¡œ ë§¤ì¹­
                    const client = clients.find(c => 
                        c.business_number?.replace(/-/g, '') === csv.business_number_no_dash
                    );

                    if (client) {
                        matched++;
                        const updates = {};

                        // ë¹„ì–´ìˆëŠ” í•„ë“œë§Œ ì—…ë°ì´íŠ¸
                        if (csv.representative && !client.representative) updates.representative = csv.representative;
                        if (csv.phone && !client.phone) updates.phone = csv.phone;
                        if (csv.email && !client.email) updates.email = csv.email;
                        if (csv.resident_number && !client.resident_number) updates.resident_number = csv.resident_number;
                        if (csv.corporate_number && !client.corporate_number) updates.corporate_number = csv.corporate_number;
                        if (csv.business_code && !client.business_code) updates.business_code = csv.business_code;
                        if (csv.address && !client.address) updates.address = csv.address;

                        if (Object.keys(updates).length > 0) {
                            const { error: updateError } = await supabase
                                .from('clients')
                                .update(updates)
                                .eq('id', client.id);

                            if (updateError) {
                                log(`âš ï¸ ${csv.company_name} ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${updateError.message}`, 'warning');
                            } else {
                                updated++;
                                const fields = Object.keys(updates).join(', ');
                                log(`âœ… ${csv.company_name} - [${fields}] ì—…ë°ì´íŠ¸`, 'success');
                            }
                        } else {
                            skipped++;
                            log(`â­ï¸ ${csv.company_name} - ì´ë¯¸ ë°ì´í„° ìˆìŒ`, 'info');
                        }
                    } else {
                        log(`âš ï¸ ${csv.company_name} (${csv.business_number}) - ë§¤ì¹­ ì‹¤íŒ¨`, 'warning');
                    }

                    // 10ê°œë§ˆë‹¤ ì§§ì€ ë”œë ˆì´ (UI ì‘ë‹µì„±)
                    if (processed % 10 === 0) {
                        await new Promise(resolve => setTimeout(resolve, 50));
                    }
                }

                log('', 'info');
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
                log('ğŸ‰ ë³µêµ¬ ì™„ë£Œ!', 'success');
                log(`ğŸ“‹ ì „ì²´ ì²˜ë¦¬: ${processed}ê°œ`, 'info');
                log(`âœ… ë§¤ì¹­ ì„±ê³µ: ${matched}ê°œ`, 'success');
                log(`ğŸ“ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${updated}ê°œ`, 'success');
                log(`â­ï¸ ê±´ë„ˆëœ€: ${skipped}ê°œ`, 'info');
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');

                // ê²°ê³¼ í‘œì‹œ
                document.getElementById('totalCount').textContent = processed;
                document.getElementById('matchedCount').textContent = matched;
                document.getElementById('updatedCount').textContent = updated;
                document.getElementById('skippedCount').textContent = skipped;
                resultBox.classList.add('show');
                refreshLink.classList.add('show');

                startBtn.disabled = false;
                startBtn.textContent = 'âœ… ë³µêµ¬ ì™„ë£Œ - ë‹¤ì‹œ ì‹¤í–‰';

                log('', 'info');
                log('ğŸ”„ ì´ì œ ë§¤ë§¤ì‚¬ì—…ì í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”!', 'success');

            } catch (error) {
                log(`âŒ ì—ëŸ¬ ë°œìƒ: ${error.message}`, 'error');
                console.error('ë³µêµ¬ ì¤‘ ì—ëŸ¬:', error);
                alert(`ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                startBtn.disabled = false;
                startBtn.textContent = 'ğŸ”„ ë‹¤ì‹œ ì‹œë„';
            } finally {
                isRestoring = false;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            console.log('ğŸ”„ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ, Supabase ì´ˆê¸°í™” ì‹œì‘...');
            setTimeout(() => {
                initSupabase();
            }, 1000);
        });

        // ì—ëŸ¬ í•¸ë“¤ë§
        window.addEventListener('error', (event) => {
            console.error('ì „ì—­ ì—ëŸ¬:', event.error);
        });
    </script>
</body>
</html>
