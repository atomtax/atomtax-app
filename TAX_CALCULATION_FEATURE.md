# 🧮 세금 계산 기능 및 비과세 여부 추가 완료 (v3.4)

## ✅ 구현 완료

물건 목록에 세금 자동 계산 기능과 비과세 여부가 추가되었습니다!

---

## 📊 추가된 기능

### 1️⃣ 비과세 여부 컬럼
- **위치**: 85초과 컬럼 오른쪽
- **옵션**: Y (비과세) / N (과세)
- **기본값**: N

### 2️⃣ 세금 계산 버튼
- **위치**: 가장 오른쪽 컬럼
- **기능**: 기납부 종소세 및 지방소득세 자동 계산
- **버튼 텍스트**: "계산"

---

## 🧮 세금 계산 로직

### 📋 2024년 종합소득세율표

| 과세표준 (양도소득) | 세율 | 누진공제 |
|------------------|------|----------|
| 1,400만원 이하 | 6% | 0원 |
| 1,400만원 초과 ~ 5,000만원 이하 | 15% | 126만원 |
| 5,000만원 초과 ~ 8,800만원 이하 | 24% | 576만원 |
| 8,800만원 초과 ~ 1억 5,000만원 이하 | 35% | 1,544만원 |
| 1억 5,000만원 초과 ~ 3억원 이하 | 38% | 1,994만원 |
| 3억원 초과 ~ 5억원 이하 | 40% | 2,594만원 |
| 5억원 초과 ~ 10억원 이하 | 42% | 3,594만원 |
| 10억원 초과 | 45% | 6,594만원 |

### 💰 계산 공식

#### 기납부 종소세
```
기납부 종소세 = (양도소득 × 세율) - 누진공제
```

#### 기납부 지방소득세
```
기납부 지방소득세 = 기납부 종소세 × 10%
```

### ⚠️ 특수 케이스

#### 1. 비과세 물건 (non_taxable = 'Y')
```
기납부 종소세 = 0원
기납부 지방소득세 = 0원
```
→ "비과세 물건입니다. 세금이 0원으로 설정되었습니다." 알림 표시

#### 2. 양도소득이 0 이하
```
계산 불가
```
→ "양도소득이 0 이하입니다. 세금을 계산할 수 없습니다." 에러 표시

---

## 🖥️ 화면 구성

### 물건 목록 테이블 (13개 컬럼)

```
┌──────────────────────────────────────────────────────────────────────┐
│ 물건명 │ 소재지 │ 취득가액 │ ... │ 85초과 │ 비과세 │ 세금계산 │
├──────────────────────────────────────────────────────────────────────┤
│ 강남 아파트 │ 서울... │ 500,000,000 │ ... │ Y │ N │ [계산] │
└──────────────────────────────────────────────────────────────────────┘
```

**컬럼 목록** (총 13개):
1. 물건명
2. 소재지
3. 취득가액 (자동)
4. 기타필요경비 (자동)
5. 양도가액
6. 양도소득 (자동)
7. 양도일
8. 신고기한 (자동)
9. 기납부 종소세
10. 기납부 지방소득세
11. 85초과 (Y/N)
12. **🆕 비과세 (Y/N)**
13. **🆕 세금계산 (버튼)**

---

## 📋 사용 방법

### ✅ 세금 자동 계산하기

#### 1단계: 양도소득 확인
- 양도가액, 취득가액, 기타필요경비 입력
- 양도소득 자동 계산 확인

#### 2단계: 비과세 여부 설정
- **비과세 물건**: Y 선택 → 세금 0원
- **과세 물건**: N 선택 (기본값)

#### 3단계: 계산 버튼 클릭
- 가장 오른쪽 **"계산"** 버튼 클릭
- 종소세 및 지방소득세 자동 계산
- 알림 팝업으로 결과 확인

#### 4단계: 저장
- **"저장"** 버튼 클릭으로 데이터 반영

---

## 💡 계산 예시

### 예시 1: 일반 과세 물건

**입력 값:**
- 양도가액: 1,000,000,000원
- 취득가액: 600,000,000원
- 기타필요경비: 50,000,000원
- **양도소득**: 350,000,000원 (자동 계산)
- **비과세**: N

**계산 과정:**
1. 과세표준: 350,000,000원
2. 해당 구간: 3억원 초과 ~ 5억원 이하
3. 세율: 40%, 누진공제: 25,940,000원
4. 기납부 종소세 = (350,000,000 × 0.40) - 25,940,000 = **114,060,000원**
5. 기납부 지방소득세 = 114,060,000 × 0.10 = **11,406,000원**

**결과:**
```
✅ 세금 계산 완료!
기납부 종소세: 114,060,000원
기납부 지방소득세: 11,406,000원
(적용 세율: 40%, 누진공제: 25,940,000원)
```

---

### 예시 2: 비과세 물건

**입력 값:**
- 양도가액: 500,000,000원
- 취득가액: 300,000,000원
- 양도소득: 200,000,000원
- **비과세**: Y

**결과:**
```
ℹ️ 비과세 물건입니다. 세금이 0원으로 설정되었습니다.
```
- 기납부 종소세: 0원
- 기납부 지방소득세: 0원

---

### 예시 3: 양도소득 0 이하

**입력 값:**
- 양도가액: 500,000,000원
- 취득가액: 600,000,000원
- 양도소득: -100,000,000원 (손실)

**결과:**
```
❌ 양도소득이 0 이하입니다. 세금을 계산할 수 없습니다.
```

---

## 🔧 기술 구현

### trader-detail.html
```html
<!-- 비과세 컬럼 -->
<th style="width: 70px;">비과세</th>

<!-- 세금계산 컬럼 -->
<th style="width: 80px;">세금계산</th>
```

### js/trader-detail.js

#### 데이터 구조
```javascript
const row = {
    property_name: '물건1',
    address: '',
    acquisition_value: 0,
    other_expenses: 0,
    transfer_value: 0,
    transfer_income: 0,
    transfer_date: '',
    report_deadline: '',
    prepaid_income_tax: 0,
    prepaid_local_tax: 0,
    over_85: 'N',
    non_taxable: 'N',  // 🆕 비과세 여부
    expenses: []
};
```

#### 세금 계산 함수
```javascript
function calculateTaxes(index) {
    const row = inventoryRows[index];
    
    // 비과세 체크
    if (row.non_taxable === 'Y') {
        row.prepaid_income_tax = 0;
        row.prepaid_local_tax = 0;
        return;
    }
    
    // 양도소득 확인
    const transferIncome = row.transfer_income || 0;
    if (transferIncome <= 0) {
        showNotification('양도소득이 0 이하입니다.', 'error');
        return;
    }
    
    // 세율 찾기
    const taxBrackets = [/* 세율표 */];
    let taxRate, deduction;
    for (const bracket of taxBrackets) {
        if (transferIncome <= bracket.limit) {
            taxRate = bracket.rate;
            deduction = bracket.deduction;
            break;
        }
    }
    
    // 종소세 계산
    const incomeTax = Math.max(0, Math.round(transferIncome * taxRate - deduction));
    
    // 지방소득세 계산
    const localTax = Math.round(incomeTax * 0.1);
    
    // 값 업데이트
    row.prepaid_income_tax = incomeTax;
    row.prepaid_local_tax = localTax;
    
    renderInventoryTable();
}
```

---

## 🚀 업데이트 내역

### v3.4 (2026-02-04)
- ✅ 물건 목록에 "비과세" 컬럼 추가 (Y/N 선택)
- ✅ 물건 목록에 "세금계산" 버튼 추가
- ✅ 2024년 종합소득세율표 적용
- ✅ 기납부 종소세 자동 계산 기능
- ✅ 기납부 지방소득세 자동 계산 기능 (종소세의 10%)
- ✅ 비과세 물건 처리 로직
- ✅ 양도소득 0 이하 예외 처리
- ✅ 계산 결과 알림 표시

---

## 📞 지원

문제가 발생하거나 개선 요청이 있으면 시스템 관리자에게 문의하세요.

**관련 파일:**
- `trader-detail.html`
- `js/trader-detail.js`

**관련 필드:**
- `non_taxable` (비과세 여부)
- `prepaid_income_tax` (기납부 종소세)
- `prepaid_local_tax` (기납부 지방소득세)
