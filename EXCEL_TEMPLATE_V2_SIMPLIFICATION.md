# 일괄업로드 양식 대폭 간소화 및 개선

## ✅ 변경 완료

### 📊 Sheet 1: 물건목록

#### 제거된 컬럼
- ❌ **취득가액** (필요경비 상세에서 자동 계산)
- ❌ **기타필요경비** (필요경비 상세에서 자동 계산)
- ❌ **신고기한** (양도일 기준 자동 계산)
- ❌ **비고**

#### 추가된 컬럼
- ✅ **취득일(YYYYMMDD)** (양도일 앞에 추가)

#### 개선된 기능
- ✅ **85초과(Y/N)**: 드롭다운으로 변경 (Y/N 선택)

#### 최종 컬럼 구조 (10개)
```
1. 사업자번호*
2. 물건명
3. 소재지
4. 양도가액
5. 취득일(YYYYMMDD) ⭐ NEW
6. 양도일(YYYYMMDD)
7. 기납부 종소세
8. 기납부 지방소득세
9. 85초과(Y/N) 🔽 드롭다운
10. 진행단계
```

---

### 📋 Sheet 2: 필요경비 상세

#### 제거된 컬럼
- ❌ **번호** (자동 넘버링)
- ❌ **비고**

#### 개선된 기능
- ✅ **구분(취득가액/기타필요경비)**: 드롭다운으로 변경

#### 최종 컬럼 구조 (6개)
```
1. 사업자번호*
2. 물건명* (물건목록과 동일)
3. 비용명
4. 구분(취득가액/기타필요경비) 🔽 드롭다운
5. 금액
6. 비용인정(O/X)
```

---

## 🎯 자동 계산 로직

### 1. 취득가액 자동 계산
```
취득가액 = 필요경비 상세에서 "구분=취득가액"인 항목들의 금액 합계
```

### 2. 기타필요경비 자동 계산
```
기타필요경비 = 필요경비 상세에서 "구분=기타필요경비"인 항목들의 금액 합계
```

### 3. 번호 자동 부여
```
각 물건의 필요경비에 대해 1, 2, 3... 순서대로 자동 넘버링
```

### 4. 신고기한 자동 계산
```
신고기한 = 양도일 + 2개월 (말일)
예: 양도일 2025-01-15 → 신고기한 2025-03-31
```

---

## 📊 컬럼 수 비교

| 항목 | Before | After | 감소율 |
|------|--------|-------|--------|
| 물건목록 | 13개 | **10개** | **23%** ⬇️ |
| 필요경비 상세 | 8개 | **6개** | **25%** ⬇️ |
| **총 컬럼** | **21개** | **16개** | **24%** ⬇️ |

---

## 🔽 드롭다운 기능

### 1. 물건목록 - 85초과(Y/N)
- 선택 옵션: `Y`, `N`
- 기본값: (빈칸)
- Excel에서 드롭다운 자동 생성

### 2. 필요경비 상세 - 구분
- 선택 옵션: `취득가액`, `기타필요경비`
- 기본값: (빈칸)
- Excel에서 드롭다운 자동 생성

---

## 📝 작성 예시

### Sheet 1: 물건목록
| 사업자번호* | 물건명 | 소재지 | 양도가액 | 취득일 | 양도일 | 기납부 종소세 | 기납부 지방소득세 | 85초과 | 진행단계 |
|-------------|--------|--------|----------|--------|--------|---------------|-------------------|--------|----------|
| 123-45-67890 | 서울시 강남구 아파트 | 서울시 강남구 테헤란로 123 | 150000000 | 20230101 | 20250115 | 1500000 | 150000 | Y | 확인 |

### Sheet 2: 필요경비 상세
| 사업자번호* | 물건명* | 비용명 | 구분 | 금액 | 비용인정 |
|-------------|---------|--------|------|------|----------|
| 123-45-67890 | 서울시 강남구 아파트 | 중개수수료 | 취득가액 | 1000000 | O |
| 123-45-67890 | 서울시 강남구 아파트 | 취득세 | 취득가액 | 500000 | O |
| 123-45-67890 | 서울시 강남구 아파트 | 수리비 | 기타필요경비 | 2000000 | X |

**결과**:
- 취득가액: 1,500,000원 (자동 계산)
- 기타필요경비: 2,000,000원 (자동 계산)
- 번호: 1, 2, 3 (자동 부여)

---

## 🔄 데이터 처리 흐름

```
[엑셀 업로드]
    ↓
[Sheet 1 읽기] → 물건 기본 정보
    ↓
[Sheet 2 읽기] → 필요경비 상세
    ↓
[매칭] → 사업자번호 + 물건명으로 매칭
    ↓
[자동 계산]
    ├─ 번호 자동 부여 (1, 2, 3...)
    ├─ 취득가액 합계 계산
    ├─ 기타필요경비 합계 계산
    └─ 신고기한 계산 (양도일 + 2개월)
    ↓
[localStorage 저장]
    ↓
[완료!]
```

---

## ✅ 개선 효과

### 1. 사용성 향상
- ✅ **입력 항목 24% 감소** (21개 → 16개)
- ✅ **드롭다운으로 오류 방지**
- ✅ **자동 계산으로 편의성 증가**

### 2. 작업 시간 단축
- ⏱️ **수동 계산 불필요**
- ⏱️ **번호 수동 입력 불필요**
- ⏱️ **데이터 검증 자동화**

### 3. 데이터 정확도 향상
- ✅ **자동 계산으로 계산 오류 방지**
- ✅ **드롭다운으로 입력 오류 방지**
- ✅ **자동 넘버링으로 순서 보장**

---

## 📁 변경된 파일

1. ✏️ `traders-data.html` - 양식 다운로드 및 업로드 처리
2. ✏️ `js/trader-detail.js` - acquisition_date 필드 추가
3. ✏️ `analyze_by_trader_sheet.html` - 분석 도구 업데이트
4. 📄 `EXCEL_TEMPLATE_V2_SIMPLIFICATION.md` - 이 문서

---

## 🎉 결과

**일괄업로드 양식이 더욱 간단하고 스마트해졌습니다!**

- 💡 **자동 계산**: 취득가액, 기타필요경비, 번호, 신고기한
- 🔽 **드롭다운**: 85초과, 구분
- ✅ **오류 감소**: 자동화로 입력 오류 최소화
- ⏱️ **시간 단축**: 수동 입력 작업 대폭 감소

---

*변경 날짜: 2026-01-30*
*버전: 2.0 - 대폭 간소화 및 자동화*
