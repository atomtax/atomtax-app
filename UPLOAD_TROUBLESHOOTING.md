# 🔍 일괄업로드 문제 해결 가이드

## 문제: 업로드가 전혀 안 되는 경우

### 🎯 진단 방법

#### 방법 1: 브라우저 콘솔 확인 (추천)
1. **F12** 키를 눌러 개발자 도구 열기
2. **Console** 탭 선택
3. **일괄 업로드** 버튼 클릭
4. 콘솔에 표시되는 로그 확인

**정상 로그:**
```
📤 업로드 시작: 매매사업자_일괄업로드_양식_2026-01-30.xlsx 12454 bytes
📋 시트 목록: ["물건목록", "필요경비상세"]
✅ 물건목록 데이터: 3 행
📊 첫 번째 행: {사업자번호*: "123-45-67890", 물건명: "강남 아파트", ...}
✅ 필요경비상세 데이터: 5 행
🔄 데이터 그룹화 시작...
📝 처리 중: 123-45-67890 강남 아파트
💾 데이터 저장 시작...
📊 그룹화된 사업자번호 수: 2
🔍 처리 중: 123-45-67890
  물건 수: 2개
  ✅ 고객사 찾음: 홍길동 (ID: abc123)
  📦 기존 데이터: 0개
  💾 저장 완료: 2개 물건 추가
  📊 총 데이터: 2개
...
📊 최종 결과:
  ✅ 성공: 3건
  ❌ 실패: 0건
  💰 필요경비 매칭: 5건
  ⚠️ 필요경비 미매칭: 0건
```

**문제가 있는 경우:**
```
❌ 물건목록 시트 없음
❌ 물건목록 데이터 없음
⚠️ 사업자번호 없음, 건너뜀
❌ 사업자번호 123-45-67890: 고객사를 찾을 수 없습니다.
```

---

#### 방법 2: 디버그 도구 사용
1. **debug_upload.html** 파일 열기
2. 업로드할 엑셀 파일 선택
3. 상세 분석 결과 확인

**확인 사항:**
- ✅ 시트 이름이 정확한가? (`물건목록`, `필요경비상세`)
- ✅ 헤더 행이 있는가? (`사업자번호*`, `물건명`, ...)
- ✅ 데이터 행이 있는가?
- ✅ 필수 컬럼이 모두 있는가?

---

## 🚨 주요 오류 원인 및 해결

### 1️⃣ 시트 이름 오류
**증상:**
```
❌ "물건목록" 시트를 찾을 수 없습니다.
```

**원인:**
- 시트 이름이 `물건목록`이 아님
- 띄어쓰기가 있음: `물건 목록`
- 오타: `물건목록표`

**해결:**
1. 엑셀에서 시트 이름 확인
2. 정확히 `물건목록` 으로 변경 (띄어쓰기 없음)

---

### 2️⃣ 데이터 없음
**증상:**
```
❌ 물건목록 데이터가 없습니다.
```

**원인:**
- 헤더만 있고 데이터 행이 없음
- 빈 행만 있음

**해결:**
1. 최소 1개 이상의 데이터 행 추가
2. 모든 행의 `사업자번호*` 입력 확인

---

### 3️⃣ 사업자번호 누락
**증상:**
```
⚠️ 사업자번호 없음, 건너뜀
```

**원인:**
- `사업자번호*` 컬럼이 비어있음

**해결:**
1. 모든 행에 사업자번호 입력
2. 형식: `123-45-67890` 또는 `1234567890`

---

### 4️⃣ 고객사를 찾을 수 없음
**증상:**
```
❌ 사업자번호 123-45-67890: 고객사를 찾을 수 없습니다.
```

**원인:**
- 입력한 사업자번호가 **고객사 DB에 없음**
- 매매사업자(업종코드 703011, 703012)가 아님

**해결 방법:**

**A. 고객사 관리에서 확인**
1. **고객사 관리** 페이지로 이동
2. 해당 사업자번호 검색
3. 존재하는지 확인
4. 업종코드가 703011 또는 703012인지 확인

**B. 사업자번호 오타 확인**
- 엑셀: `123-45-67890`
- DB: `123-45-67891` (마지막 숫자 다름)
- → 정확히 일치해야 함!

**C. 고객사 먼저 등록**
1. 고객사 관리에서 거래처 추가
2. 업종코드를 703011 또는 703012로 설정
3. 다시 업로드

---

### 5️⃣ 컬럼명 오류
**증상:**
```
⚠️ 사업자번호 없음, 건너뜀 (모든 행)
```

**원인:**
- 컬럼명이 `사업자번호`가 아니라 `사업자번호*`가 아님
- 오타: `사업자번`, `사업자번호 *` (띄어�기)

**해결:**
1. 헤더 행의 컬럼명 확인
2. 정확히 `사업자번호*` 입력 (별표 포함, 띄어쓰기 없음)

---

## ✅ 올바른 엑셀 구조

### 물건목록 시트
```
행1: 안내 메시지 (선택사항)
행2: 빈 행 (선택사항)
행3: 사업자번호* | 물건명 | 소재지 | 양도가액 | 취득일(YYYYMMDD) | 양도일(YYYYMMDD) | 기납부 종소세 | 기납부 지방소득세 | 85초과(Y/N)
행4: 123-45-67890 | 강남 아파트 | 서울... | 150000000 | 20230101 | 20250115 | 1500000 | 150000 | Y
행5: 123-45-67890 | 서초 오피스텔 | 서울... | 120000000 | 20230201 | 20250220 | 1000000 | 100000 | N
```

**중요:**
- 헤더 행 위에 안내 메시지가 있어도 OK (최대 2-3행)
- 헤더 행에 `사업자번호*`가 포함되어야 함
- 데이터 행은 헤더 바로 아래부터 시작

---

### 필요경비상세 시트
```
행3: 사업자번호* | 물건명* (물건목록과 동일) | 비용명 | 구분(취득가액/기타필요경비) | 금액 | 비용인정(O/X)
행4: 123-45-67890 | 강남 아파트 | 중개수수료 | 취득가액 | 1000000 | O
행5: 123-45-67890 | 강남 아파트 | 취득세 | 취득가액 | 500000 | O
```

---

## 🎯 체크리스트

업로드하기 전에 다음을 확인하세요:

- [ ] 시트 이름이 정확한가? (`물건목록`, `필요경비상세`)
- [ ] 헤더 행이 있는가? (`사업자번호*`, `물건명`, ...)
- [ ] 데이터 행이 1개 이상 있는가?
- [ ] 모든 행에 `사업자번호*`가 입력되었는가?
- [ ] 사업자번호가 고객사 DB에 존재하는가?
- [ ] 업종코드가 703011 또는 703012인가?
- [ ] 날짜 형식이 올바른가? (YYYYMMDD 또는 엑셀 시리얼)
- [ ] 85초과가 Y 또는 N인가?
- [ ] 구분이 "취득가액" 또는 "기타필요경비"인가?

---

## 💡 빠른 해결 팁

1. **양식 다시 다운로드**
   - 최신 양식 사용 권장
   - 기존 양식에 문제가 있을 수 있음

2. **샘플 데이터로 테스트**
   - 양식에 포함된 샘플 데이터로 먼저 테스트
   - 성공하면 본인 데이터로 교체

3. **한 줄씩 추가**
   - 1개 거래처만 먼저 업로드
   - 성공하면 나머지 추가

4. **콘솔 로그 확인**
   - F12 → Console 탭
   - 정확한 오류 메시지 확인

---

## 📞 여전히 안 된다면?

**스크린샷 공유:**
1. F12 → Console 탭의 로그
2. 엑셀 파일의 첫 5행
3. 오류 메시지

이 정보를 공유하면 정확한 원인을 찾을 수 있습니다!

---

완료! 🎉
