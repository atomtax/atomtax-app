# 📄 OCR 서류 업로드 가이드

## 🎯 기능 개요

매매사업자 상세 페이지의 **물건목록**에서 각 물건마다 서류를 업로드하면, OCR(광학 문자 인식)을 통해 자동으로 데이터를 추출하여 물건목록과 필요경비 상세에 입력합니다.

---

## 📋 지원 서류 종류

### 1️⃣ 매각대금 완납증명원
**추출 데이터:**
- 매각대금: `256,900,000` → **물건목록 - 취득가액**
- 매각대금 완납일: `2025.12.16` → **물건목록 - 취득일**
- 비용명: `취득가액`
- 구분: `취득가액`
- 예정신고 비용인정: `O`
- 종합소득세 비용인정: `O`

**필요경비 상세 자동 생성:**
| 비용명 | 구분 | 금액 | 예정신고 | 종합소득세 | 비고 |
|--------|------|------------|----------|-----------|------|
| 취득가액 | 취득가액 | 256,900,000 | O | O | 매각대금 완납증명원 |

---

### 2️⃣ 부동산의 표시
**추출 데이터:**
- 주소: `경기도 포천시 군내면 구읍리 740 포천아이파크 104동`
- 전유부분: `8층801호`
- **결합 소재지**: `경기도 포천시 군내면 구읍리 740 포천아이파크 104동 801호` → **물건목록 - 소재지**
- 면적: `84.8954㎡` → **85초과 판단**: `N` (84.8954 < 85)
- 물건명: `포천아이파크 104동 801호` → **물건목록 - 물건명**

---

### 3️⃣ 부동산(주거용) 매매 전자계약서
**추출 데이터:**
- 건물 면적: `84.8954㎡` → **85초과 판단**: `N`
- 매매대금: `294,000,000` → **물건목록 - 양도가액**
- 잔금일: `2026년 1월 28일` → **물건목록 - 양도일**

**자동 계산:**
- 신고기한: 양도일 + 2개월 (말일 기준)
  - 양도일: 2026-01-28
  - 신고기한: 2026-03-31

---

### 4️⃣ 등기비용내역서
**추출 데이터:**
- 총계: `4,439,530` → **물건목록 - 기타필요경비**

**필요경비 상세 자동 생성:**
| 비용명 | 구분 | 금액 | 예정신고 | 종합소득세 | 비고 |
|--------|------|---------|----------|-----------|------|
| 취득세 | 취득가액 | 4,439,530 | O | O | 등기비용내역서 |

---

## 🚀 사용 방법

### 1️⃣ 물건 행 확장
1. 매매사업자 상세 페이지 열기
2. 물건목록 테이블에서 원하는 물건 행 클릭
3. 상세 정보 패널이 펼쳐짐

### 2️⃣ 서류 업로드
1. **빨간색 "서류 업로드"** 버튼 클릭 (펄스 애니메이션으로 강조됨)
2. 파일 선택 창에서 서류 선택
   - **지원 형식**: PDF, JPG, JPEG, PNG
   - **다중 선택 가능**: 여러 서류를 한 번에 업로드
3. "열기" 클릭

### 3️⃣ 자동 처리
시스템이 자동으로:
- 📄 파일 읽기
- 🤖 OCR 데이터 추출
- 📊 서류 종류 자동 판별
- ✏️ 물건목록 자동 입력
- 💰 필요경비 상세 자동 생성
- 💾 자동 저장

### 4️⃣ 확인 및 수정
1. 자동 입력된 데이터 확인
2. 필요시 수동 수정
3. "저장" 버튼 클릭 (자동 저장됨)

---

## 📊 자동 입력 규칙

### 물건목록 필드
| 필드명 | 데이터 출처 | 예시 값 |
|--------|------------|---------|
| 물건명 | 부동산의 표시 | 포천아이파크 104동 801호 |
| 소재지 | 부동산의 표시 | 경기도 포천시... 801호 |
| 취득가액 | 매각대금 완납증명원 | 256,900,000 |
| 기타필요경비 | 등기비용내역서 | 4,439,530 |
| 양도가액 | 매매 전자계약서 | 294,000,000 |
| 양도소득 | 자동 계산 | 32,660,470 |
| 취득일 | 매각대금 완납증명원 | 2025-12-16 |
| 양도일 | 매매 전자계약서 | 2026-01-28 |
| 신고기한 | 자동 계산 | 2026-03-31 |
| 85초과 | 자동 판단 | N |

### 필요경비 상세 자동 생성
| 서류 종류 | 비용명 | 구분 | 금액 | 예정신고 | 종합소득세 |
|-----------|--------|------|----------|----------|-----------|
| 매각대금 완납증명원 | 취득가액 | 취득가액 | 256,900,000 | O | O |
| 등기비용내역서 | 취득세 | 취득가액 | 4,439,530 | O | O |

---

## 🎨 UI 강조 표시

### 서류 업로드 버튼
- **색상**: 빨간색 (#dc2626)
- **애니메이션**: 펄스 효과 (2초 간격)
- **호버**: 어두운 빨간색 + 확대 효과

### 진행단계 색상
| 단계 | 배경색 | 글자색 |
|------|--------|--------|
| 미확인 | 회색 | 회색 |
| 확인 | 파란색 | 진한 파란색 |
| 위하고입력 | 주황색 | 진한 주황색 |
| 고객안내 | 노란색 | 진한 노란색 |
| 신고완료 | 녹색 | 진한 녹색 |

---

## 🔍 OCR 처리 과정

### 1단계: 파일 읽기
```javascript
const fileData = await fileToBase64(file);
```

### 2단계: 서류 종류 자동 판별
```
파일명에서 키워드 감지:
- "완납" 또는 "매각대금" → 매각대금 완납증명원
- "표시" 또는 "등기" → 부동산의 표시
- "계약" 또는 "매매" → 매매 전자계약서
- "등기비용" 또는 "내역" → 등기비용내역서
```

### 3단계: 데이터 추출
```javascript
const ocrResult = await analyzeDocumentOCR(fileData, fileName);
```

### 4단계: 데이터 병합 및 자동 입력
```javascript
await autoFillPropertyData(propertyIndex, extractedData);
```

---

## ⚠️ 주의사항

### 빈 칸 처리
- OCR로 읽지 못한 데이터는 **빈 칸으로 유지**됩니다
- 수동으로 입력해야 합니다

### 데이터 누적
- 여러 서류를 업로드하면 데이터가 **누적**됩니다
- 예: 
  - 매각대금 완납증명원: 취득가액 +256,900,000
  - 등기비용내역서: 기타필요경비 +4,439,530
  - **총 취득가액**: 256,900,000
  - **총 기타필요경비**: 4,439,530

### 85초과 판단
- 면적 데이터가 있을 때만 자동 판단
- 면적 > 85㎡ → `Y`
- 면적 ≤ 85㎡ → `N`

---

## 🧪 테스트 시나리오

### 시나리오 1: 전체 서류 업로드
1. 물건 행 확장
2. "서류 업로드" 클릭
3. 4개 서류 모두 선택:
   - 매각대금_완납증명원.pdf
   - 부동산_표시.pdf
   - 매매_전자계약서.pdf
   - 등기비용내역서.pdf
4. 업로드
5. 자동 입력 확인

**예상 결과:**
- 물건명: `포천아이파크 104동 801호`
- 소재지: `경기도 포천시 군내면 구읍리 740 포천아이파크 104동 801호`
- 취득가액: `256,900,000`
- 기타필요경비: `4,439,530`
- 양도가액: `294,000,000`
- 양도소득: `32,660,470`
- 취득일: `2025-12-16`
- 양도일: `2026-01-28`
- 신고기한: `2026-03-31`
- 85초과: `N`
- 필요경비: 2개 항목 자동 생성

---

## 📝 개발 로그

### Console 출력 예시
```
📂 물건 0번 - 4개 파일 업로드 시작
🔍 4개 파일 OCR 처리 중...
📄 파일 1: 매각대금_완납증명원.pdf (application/pdf)
🤖 OCR 분석 중: 매각대금_완납증명원.pdf
📋 서류 종류: 매각대금 완납증명원
📄 파일 2: 부동산_표시.pdf (application/pdf)
🤖 OCR 분석 중: 부동산_표시.pdf
📋 서류 종류: 부동산의 표시
📄 파일 3: 매매_전자계약서.pdf (application/pdf)
🤖 OCR 분석 중: 매매_전자계약서.pdf
📋 서류 종류: 부동산 매매 전자계약서
📄 파일 4: 등기비용내역서.pdf (application/pdf)
🤖 OCR 분석 중: 등기비용내역서.pdf
📋 서류 종류: 등기비용내역서
📐 면적: 84.8954㎡ → 85초과: N
✅ OCR 추출 완료: {property_name, address, ...}
✏️ 물건 0번 자동 입력 시작: {...}
💰 필요경비 2개 추가됨
✅ 물건 0번 자동 입력 완료
```

---

## 🎯 다음 단계

### 실제 OCR API 연동 (Optional)
현재는 **시뮬레이션 모드**로 파일명 기반 데이터 추출을 수행합니다.

실제 OCR API를 연동하려면:
```javascript
// analyzeDocumentOCR 함수 수정
const response = await fetch('/api/ocr/analyze', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ image: fileData, fileName })
});
return await response.json();
```

**추천 OCR 서비스:**
- Google Cloud Vision API
- AWS Textract
- Naver Clova OCR
- Kakao Vision API

---

## 📞 문제 해결

### 파일이 업로드되지 않음
- 파일 형식 확인 (PDF, JPG, PNG만 지원)
- 파일 크기 확인 (최대 10MB)
- 브라우저 콘솔에서 오류 확인 (F12)

### 데이터가 자동 입력되지 않음
- OCR 결과 확인 (콘솔 로그)
- 파일명에 키워드 포함 여부 확인
- 수동으로 입력 가능

### 잘못된 데이터가 입력됨
- 자동 입력 후 수정 가능
- 각 필드 개별 수정 가능
- 삭제 후 다시 업로드 가능

---

## ✅ 완료 체크리스트

- [x] 서류 업로드 버튼 추가 (빨간색 강조)
- [x] 다중 파일 업로드 지원
- [x] OCR 데이터 추출 (시뮬레이션)
- [x] 물건목록 자동 입력
- [x] 필요경비 상세 자동 생성
- [x] 85초과 자동 판단
- [x] 신고기한 자동 계산
- [x] 양도소득 자동 계산
- [x] localStorage 자동 저장
- [x] UI 즉시 업데이트
- [x] 진행단계 색상 표시
- [x] 부동산 폴더 버튼 추가

---

**마지막 업데이트**: 2026-02-10  
**버전**: 1.0  
**작성자**: Claude AI + 사용자
