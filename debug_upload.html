<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì—‘ì…€ íŒŒì¼ ë””ë²„ê¹… ë„êµ¬</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #667eea; }
        .upload-area { border: 2px dashed #667eea; padding: 30px; text-align: center; border-radius: 8px; margin: 20px 0; cursor: pointer; }
        .upload-area:hover { background: #f0f4ff; }
        .result { margin-top: 20px; }
        .success { color: #10b981; background: #d1fae5; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .error { color: #ef4444; background: #fee2e2; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .warning { color: #f59e0b; background: #fef3c7; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .info { color: #3b82f6; background: #dbeafe; padding: 15px; border-radius: 5px; margin: 10px 0; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { border: 1px solid #d1d5db; padding: 8px; text-align: left; font-size: 12px; }
        th { background: #4b5563; color: white; }
        pre { background: #1f2937; color: #10b981; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 11px; max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š ì—‘ì…€ íŒŒì¼ ë””ë²„ê¹… ë„êµ¬</h1>
        
        <div class="upload-area" id="uploadArea">
            <input type="file" id="fileInput" accept=".xlsx,.xls" style="display: none;">
            <p>ğŸ“ í´ë¦­í•˜ì—¬ ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ</p>
            <p style="font-size: 12px; color: #6b7280;">ë˜ëŠ” íŒŒì¼ì„ ë“œë˜ê·¸ & ë“œë¡­</p>
        </div>
        
        <div id="result" class="result"></div>
    </div>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const result = document.getElementById('result');

        uploadArea.onclick = () => fileInput.click();
        
        uploadArea.ondragover = (e) => {
            e.preventDefault();
            uploadArea.style.background = '#e0e7ff';
        };
        
        uploadArea.ondragleave = () => {
            uploadArea.style.background = '';
        };
        
        uploadArea.ondrop = (e) => {
            e.preventDefault();
            uploadArea.style.background = '';
            if (e.dataTransfer.files.length > 0) {
                handleFile(e.dataTransfer.files[0]);
            }
        };
        
        fileInput.onchange = (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        };

        function handleFile(file) {
            result.innerHTML = '<div class="info">â³ íŒŒì¼ ë¶„ì„ ì¤‘...</div>';
            
            const reader = new FileReader();
            
            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    
                    analyzeWorkbook(workbook, file.name);
                } catch (error) {
                    result.innerHTML = `<div class="error">âŒ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ${error.message}</div>`;
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        function analyzeWorkbook(workbook, fileName) {
            let html = '';
            
            // ê¸°ë³¸ ì •ë³´
            html += `<div class="success">âœ… íŒŒì¼: ${fileName}</div>`;
            html += `<div class="info">ğŸ“‹ ì´ ì‹œíŠ¸ ìˆ˜: ${workbook.SheetNames.length}</div>`;
            html += `<div class="info">ğŸ“‘ ì‹œíŠ¸ ì´ë¦„: ${workbook.SheetNames.join(', ')}</div>`;
            
            // í•„ìˆ˜ ì‹œíŠ¸ ì²´í¬
            const hasInventory = workbook.SheetNames.includes('ë¬¼ê±´ëª©ë¡');
            const hasExpense = workbook.SheetNames.includes('í•„ìš”ê²½ë¹„ìƒì„¸');
            
            if (!hasInventory) {
                html += `<div class="error">âŒ "ë¬¼ê±´ëª©ë¡" ì‹œíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤!</div>`;
            }
            
            if (!hasExpense) {
                html += `<div class="warning">âš ï¸ "í•„ìš”ê²½ë¹„ìƒì„¸" ì‹œíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. (ì„ íƒì‚¬í•­)</div>`;
            }
            
            // ê° ì‹œíŠ¸ ë¶„ì„
            workbook.SheetNames.forEach(sheetName => {
                const sheet = workbook.Sheets[sheetName];
                const jsonData = XLSX.utils.sheet_to_json(sheet, {header: 1, defval: ''});
                
                html += `<h2>ğŸ“„ ì‹œíŠ¸: ${sheetName}</h2>`;
                
                // ë¹ˆ ì‹œíŠ¸ ì²´í¬
                if (jsonData.length === 0) {
                    html += `<div class="error">âŒ ë¹ˆ ì‹œíŠ¸ì…ë‹ˆë‹¤!</div>`;
                    return;
                }
                
                // í—¤ë” ë¶„ì„
                let headerRow = -1;
                for (let i = 0; i < Math.min(5, jsonData.length); i++) {
                    if (jsonData[i].some(cell => String(cell).includes('ì‚¬ì—…ìë²ˆí˜¸'))) {
                        headerRow = i;
                        break;
                    }
                }
                
                if (headerRow === -1) {
                    html += `<div class="error">âŒ í—¤ë” í–‰ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤! (ì‚¬ì—…ìë²ˆí˜¸* ì»¬ëŸ¼ ì—†ìŒ)</div>`;
                    html += `<div class="info">ğŸ“Š ì²˜ìŒ 5í–‰:</div>`;
                    html += '<table>';
                    jsonData.slice(0, 5).forEach((row, idx) => {
                        html += '<tr>';
                        html += `<th>í–‰ ${idx + 1}</th>`;
                        row.forEach(cell => {
                            html += `<td>${cell}</td>`;
                        });
                        html += '</tr>';
                    });
                    html += '</table>';
                    return;
                }
                
                html += `<div class="success">âœ… í—¤ë” í–‰: ${headerRow + 1}í–‰</div>`;
                
                const headers = jsonData[headerRow];
                html += `<div class="info">ğŸ“‹ ì»¬ëŸ¼ ìˆ˜: ${headers.length}ê°œ</div>`;
                
                // í—¤ë” ì¶œë ¥
                html += '<h3>ì»¬ëŸ¼ ëª©ë¡:</h3>';
                html += '<table>';
                html += '<tr><th>ë²ˆí˜¸</th><th>ì»¬ëŸ¼ëª…</th></tr>';
                headers.forEach((header, idx) => {
                    html += `<tr><td>${idx + 1}</td><td>${header}</td></tr>`;
                });
                html += '</table>';
                
                // ë°ì´í„° í–‰ ë¶„ì„
                const dataRows = jsonData.slice(headerRow + 1);
                const nonEmptyRows = dataRows.filter(row => row.some(cell => cell !== ''));
                
                html += `<div class="info">ğŸ“Š ì „ì²´ í–‰ ìˆ˜: ${dataRows.length}ê°œ</div>`;
                html += `<div class="info">ğŸ“Š ë°ì´í„°ê°€ ìˆëŠ” í–‰: ${nonEmptyRows.length}ê°œ</div>`;
                
                if (nonEmptyRows.length === 0) {
                    html += `<div class="error">âŒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!</div>`;
                    return;
                }
                
                // JSON ë³€í™˜ í…ŒìŠ¤íŠ¸
                const jsonResult = XLSX.utils.sheet_to_json(sheet, {defval: ''});
                html += `<div class="success">âœ… JSON ë³€í™˜ ì„±ê³µ: ${jsonResult.length}ê°œ í–‰</div>`;
                
                // í•„ìˆ˜ ì»¬ëŸ¼ ì²´í¬ (ë¬¼ê±´ëª©ë¡)
                if (sheetName === 'ë¬¼ê±´ëª©ë¡') {
                    const requiredColumns = ['ì‚¬ì—…ìë²ˆí˜¸*', 'ë¬¼ê±´ëª…'];
                    const missingColumns = requiredColumns.filter(col => 
                        !headers.some(h => String(h).includes(col.replace('*', '')))
                    );
                    
                    if (missingColumns.length > 0) {
                        html += `<div class="error">âŒ í•„ìˆ˜ ì»¬ëŸ¼ ëˆ„ë½: ${missingColumns.join(', ')}</div>`;
                    } else {
                        html += `<div class="success">âœ… í•„ìˆ˜ ì»¬ëŸ¼ ëª¨ë‘ ì¡´ì¬</div>`;
                    }
                }
                
                // ì²« 3ê°œ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°
                html += '<h3>ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° (ì²˜ìŒ 3ê°œ):</h3>';
                html += '<pre>' + JSON.stringify(jsonResult.slice(0, 3), null, 2) + '</pre>';
            });
            
            result.innerHTML = html;
        }
    </script>
</body>
</html>
