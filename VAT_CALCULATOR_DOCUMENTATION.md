# 부가가치세 계산기 개발 문서

## 📊 개요

매매사업자용 건물분 부가가치세 자동 계산 시스템

**파일**: `traders-vat-calculator.html`

---

## ✅ 구현 완료 기능

### 1. 기본 정보 입력
- **물건 위치**: Daum 주소검색 API 연동
- **토지 면적**: m² 단위 (소수점 4자리)
- **건물 면적**: m² 단위 (소수점 4자리)
- **매도예상가**: 원 단위 (숫자만 입력)

### 2. 건축물 정보
- **건축물대장 업로드**: PDF/이미지 파일 지원
- **OCR 자동 추출**: Tesseract.js 활용
  - 준공연도 자동 인식
  - 연면적 자동 인식
  - 구조 자동 인식 (철근콘크리트, 철골조 등)
- **수동 수정**: OCR 결과를 사용자가 직접 수정 가능

### 3. 자동 조회 정보
- **토지공시지가 조회**:
  - realtyprice.kr 연동 시도
  - CORS 이슈로 수동 입력 안내
  - 개별공시지가 최근자 활용
- **건물기준시가 계산**:
  - 자체 계산식 제공 (근사치)
  - 건물신축가격기준액: 850,000원 기본값
  - 구조지수, 경과연수, 잔가율 반영
  - 건물기준시가.com 직접 조회 권장

### 4. 계산 로직

#### 엑셀 수식 정확 구현:

```javascript
// 토지가액 계산
토지가액 = 토지공시지가 × 토지면적

// 건물가액 계산
건물가액 = 건물기준시가 × 건물면적

// 매매가에 vat 포함 시가
부가가치세 시가 = 매도예상가 × 건물가액 / (토지가액 + 건물가액 × 1.1) × 0.1

// 매매가에 vat 미포함 시가
부가가치세 시가 = 매도예상가 × 건물가액 / (토지가액 + 건물가액) × 0.1

// 최저가 (70%)
부가가치세 최저가 = 부가가치세 시가 × 0.7
```

#### 건물기준시가 자체 계산:

```javascript
// 경과연수
경과연수 = 현재년도 - 준공연도

// 내용연수 (주거용 건물 기준)
내용연수 = 50년

// 연상각률
연상각률 = 0.9 / 50 = 0.018

// 잔가율
잔가율 = 1 - (경과연수 × 연상각률)
최소 잔가율 = 0.1 (10%)

// m²당 금액
m²당 금액 = 건물신축가격기준액 × (구조지수/100) × (용도지수/100) × (위치지수/100) × 잔가율

// 건물가격
건물가격 = m²당 금액 × 연면적
```

### 5. 계산 결과 표시

#### 기본 정보
- 물건 위치
- 건물 면적
- 토지 면적 (대지권)
- 매도예상가

#### 토지/건물가액
- 토지 공시지가 (원/m²)
- 토지가액
- 건물기준시가 (원/m²)
- 건물가액

#### 부가가치세 금액 계산
| 구분 | 매매가에 vat 포함 | 매매가에 vat 미포함 | 비고 |
|------|------------------|-------------------|------|
| 부가가치세 시가 | 계산값 | 계산값 | 일반적으로 매매가에 vat 포함으로 계산 |
| 부가가치세 최저가(70%) | 시가 × 0.7 | 시가 × 0.7 | 시가의 30%까지 차이나더라도 계상 가능 |

### 6. 추가 기능
- **PDF 다운로드**: jsPDF로 계산 결과 PDF 생성
- **인쇄**: 브라우저 인쇄 기능
- **초기화**: 모든 입력값 초기화
- **새로고침 시 데이터 초기화**: 세션 독립성 보장

---

## 🔧 기술 스택

### 외부 라이브러리
- **Daum Postcode API**: 주소 검색
- **Tesseract.js**: OCR (한글+영어 인식)
- **jsPDF**: PDF 생성
- **Font Awesome**: 아이콘
- **Google Fonts (Inter)**: 폰트

### 최적화
- Font Awesome 최소화 (fontawesome.min.css + solid.min.css)
- Google Fonts 웨이트 최적화 (400, 600, 700)
- Preconnect (fonts.googleapis.com, cdn.jsdelivr.net)
- Preload (css/style.css)

---

## 🚨 제한사항 및 대안

### 1. 토지공시지가 API
- **문제**: CORS 정책으로 직접 API 호출 불가
- **대안**: 
  - 사용자에게 https://www.realtyprice.kr 직접 방문 안내
  - 개별공시지가 최근자 수동 입력
  - 향후 서버 프록시 구현 시 자동화 가능

### 2. 건물기준시가 API
- **문제**: 건물기준시가.com 스크래핑 불가 (CORS)
- **대안**:
  - 자체 계산식으로 근사치 제공
  - 사용자에게 https://건물기준시가.com 직접 방문 권장
  - 계산 후 수동 수정 가능

### 3. OCR 정확도
- **문제**: 한글 OCR 정확도 제한
- **대안**:
  - OCR 결과를 수동 수정 가능하게 구현
  - 이미지 품질이 좋을수록 정확도 향상
  - PDF는 현재 지원 안 함 (이미지로 변환 필요)

---

## 📝 사용 방법

### 1단계: 기본 정보 입력
1. "주소 검색" 버튼 클릭 → Daum 주소 검색
2. 토지 면적 입력 (예: 21.7512)
3. 건물 면적 입력 (예: 242.8263)
4. 매도예상가 입력 (예: 740000000)

### 2단계: 건축물 정보 (선택)
1. 건축물대장 업로드 (이미지 권장)
2. OCR 자동 추출 대기
3. 추출된 정보 확인 및 수정:
   - 준공연도
   - 연면적
   - 구조

### 3단계: 자동 조회
1. "조회" 버튼 클릭 → 토지공시지가 자동 조회 시도
2. 실패 시 realtyprice.kr에서 직접 조회 후 입력
3. "계산" 버튼 클릭 → 건물기준시가 자동 계산
4. 필요 시 건물기준시가.com에서 정확한 값 확인 후 수정

### 4단계: 계산
1. "부가가치세 계산하기" 버튼 클릭
2. 계산 결과 확인
3. PDF 다운로드 또는 인쇄

---

## 🔄 데이터 흐름

```
1. 주소 검색 (Daum API)
   ↓
2. 토지공시지가 조회 (realtyprice.kr - 수동)
   ↓
3. 건축물대장 업로드 (선택)
   ↓
4. OCR 자동 추출 (Tesseract.js)
   ↓
5. 건물기준시가 자동 계산
   ↓
6. 부가가치세 계산
   ↓
7. 결과 표시 & PDF 다운로드
```

---

## 🎯 향후 개선 사항

### 우선순위 높음
1. **서버 프록시 구현**: 토지공시지가/건물기준시가 API 자동 연동
2. **PDF 한글 폰트**: 현재 영문으로 표시, 한글 폰트 추가 필요
3. **PDF 업로드 지원**: 현재 이미지만 지원, PDF 변환 기능 추가

### 우선순위 중간
4. **OCR 정확도 향상**: 전처리 알고리즘 추가
5. **계산 히스토리**: localStorage에 계산 이력 저장
6. **템플릿 저장**: 자주 사용하는 값 저장

### 우선순위 낮음
7. **모바일 최적화**: 반응형 디자인 강화
8. **다크 모드**: 사용자 선호도 지원
9. **엑셀 내보내기**: PDF 외 엑셀 형식 지원

---

## 📊 테스트 데이터

### 예시 1 (엑셀 기준)
```
입력:
- 건물신축가격기준액: 850,000원
- 연면적: 243m²
- 토지 공시지가: 3,553,000원/m²
- 토지 면적: 21.7512m²
- 건물 면적: 242.8263m²
- 매도예상가: 740,000,000원
- 준공연도: 2013년
- 구조: 철근콘크리트

계산 결과:
- 토지가액: 77,282,014원
- 건물가액: 213,601,669원
- 부가가치세 시가 (vat 포함): 50,622,369원
- 부가가치세 최저가 (70%): 35,435,659원
- 부가가치세 시가 (vat 미포함): 54,339,671원
- 부가가치세 최저가 (70%): 38,037,769원
```

---

## 📞 문의

기능 개선 요청이나 버그 리포트는 개발팀에 문의하세요.
