# 🤖 홈택스 자동 다운로드 스크립트 설치 가이드

## 📋 목차
1. [준비물](#준비물)
2. [설치 방법](#설치-방법)
3. [사용 방법](#사용-방법)
4. [문제 해결](#문제-해결)
5. [고급 사용법](#고급-사용법)

---

## 🎯 기능

- ✅ 홈택스 자동 접속
- ✅ 공인인증서 로그인 지원
- ✅ 신고자료 자동 다운로드
- ✅ 폴더 자동 생성 및 파일 정리
- ✅ 연도/월별 자동 분류

---

## 준비물

### 1. Python 설치

**다운로드**: https://www.python.org/downloads/

#### Windows 설치 방법:

1. 위 링크에서 최신 버전 다운로드 (예: Python 3.11.x)
2. 다운로드한 파일 실행
3. **⚠️ 중요: "Add Python to PATH" 체크박스를 반드시 선택!**
4. "Install Now" 클릭
5. 설치 완료 후 확인:
   ```cmd
   python --version
   ```
   출력 예시: `Python 3.11.7`

### 2. Chrome 브라우저

홈택스 자동화는 Chrome 브라우저를 사용합니다.

**다운로드**: https://www.google.com/chrome/

---

## 설치 방법

### Step 1: 프로젝트 다운로드

1. 프로젝트 전체 다운로드 (ZIP 파일)
2. 압축 해제
3. `automation` 폴더 확인

### Step 2: 필요한 라이브러리 설치

**명령 프롬프트(CMD) 또는 PowerShell**을 열고 다음 명령어 실행:

```bash
pip install selenium
```

#### 설치 확인:
```bash
pip show selenium
```

출력 예시:
```
Name: selenium
Version: 4.16.0
...
```

### Step 3: ChromeDriver 자동 설치

Selenium 4.6 이상 버전은 ChromeDriver를 자동으로 관리합니다.

만약 오류가 발생하면 수동 설치:

1. Chrome 버전 확인:
   - Chrome 실행 → 우측 상단 ⋮ → 도움말 → Chrome 정보
   - 예: `120.0.6099.224`

2. ChromeDriver 다운로드:
   - https://chromedriver.chromium.org/downloads
   - Chrome 버전과 동일한 버전 선택

3. 다운로드한 `chromedriver.exe` 파일을:
   - `C:\Windows\System32\` 에 복사
   - 또는 `automation` 폴더에 복사

---

## 사용 방법

### 방법 1: 간단 실행 (더블 클릭)

1. `automation` 폴더로 이동
2. `hometax_auto_download.py` 파일 **더블 클릭**
3. 화면 안내에 따라 진행

### 방법 2: 명령어로 실행

```bash
# 폴더 이동
cd 경로/atom-tax-system/automation

# 실행
python hometax_auto_download.py
```

### 실행 과정

```
1. 스크립트 실행
   ↓
2. 연도/월 입력 (엔터 = 현재 월)
   ↓
3. 저장 경로 입력 (엔터 = 기본 경로)
   ↓
4. Enter 눌러 시작
   ↓
5. Chrome 브라우저 자동 실행
   ↓
6. 홈택스 자동 접속
   ↓
7. 🔐 공인인증서 로그인 (수동)
   - 공인인증서 선택
   - 비밀번호 입력
   ↓
8. 신고자료 페이지 자동 이동
   ↓
9. 파일 자동 다운로드
   ↓
10. 폴더 자동 정리
   ↓
11. 완료! 🎉
```

---

## 📂 파일 구조

### 다운로드 후 폴더 구조:

```
D:/홈택스_신고자료/
├── 2024년01월_홈택스신고자료_20240209_143052/
│   ├── 신고자료_202401.xlsx
│   ├── 부가세신고_202401.pdf
│   └── ...
├── 2024년02월_홈택스신고자료_20240209_150320/
│   └── ...
└── ...
```

### 폴더명 형식:
```
{연도}년{월}월_홈택스신고자료_{다운로드일시}
```

---

## 문제 해결

### 1. "python을 찾을 수 없습니다" 오류

**원인**: Python이 PATH에 등록되지 않음

**해결**:
1. Python 재설치 (⚠️ "Add Python to PATH" 체크)
2. 또는 수동으로 PATH 추가:
   - 시스템 환경 변수 편집
   - PATH에 추가: `C:\Users\사용자명\AppData\Local\Programs\Python\Python311`

### 2. "selenium 모듈을 찾을 수 없습니다" 오류

**해결**:
```bash
pip install selenium
```

또는:
```bash
python -m pip install selenium
```

### 3. ChromeDriver 오류

**오류 메시지**:
```
selenium.common.exceptions.SessionNotCreatedException: 
Message: session not created: This version of ChromeDriver only supports Chrome version XX
```

**해결**:
1. Chrome 버전 확인
2. 동일한 버전의 ChromeDriver 다운로드
3. `automation` 폴더에 `chromedriver.exe` 복사

### 4. 로그인 시간 초과

**증상**: "로그인 시간이 초과되었습니다" 메시지

**해결**:
- 공인인증서 선택 및 비밀번호 입력을 60초 이내에 완료
- 또는 스크립트의 대기 시간 수정 (하단 "고급 사용법" 참조)

### 5. 다운로드 버튼을 찾을 수 없음

**원인**: 홈택스 화면 구조 변경

**해결**:
- 메시지가 나타나면 **수동으로** 다운로드 버튼 클릭
- 스크립트는 계속 진행됨
- 파일 정리는 자동으로 수행됨

### 6. 파일이 정리되지 않음

**원인**: 다운로드 폴더 위치가 다름

**해결**:
- 스크립트 실행 후 표시되는 "다운로드 폴더" 경로 확인
- 해당 폴더에서 수동으로 파일 이동

---

## 고급 사용법

### 1. 설정 변경

스크립트 상단 부분 수정:

```python
# 기본 저장 경로 변경
download_base_path="E:/내_홈택스자료"  # 원하는 경로로 변경

# 로그인 대기 시간 변경 (초 단위)
for i in range(120, 0, -5):  # 60초 → 120초로 변경
```

### 2. 여러 달 자동 다운로드

스크립트 끝부분에 추가:

```python
# 최근 3개월 자동 다운로드
downloader = HometaxAutoDownloader()
for month in [1, 2, 3]:
    downloader.run(2024, month)
```

### 3. 예약 실행 (Windows 작업 스케줄러)

#### 단계:

1. **Windows 작업 스케줄러** 열기
   - 시작 메뉴 → "작업 스케줄러" 검색

2. **기본 작업 만들기** 클릭

3. **설정**:
   - 이름: "홈택스 자동 다운로드"
   - 트리거: 매월 1일 오전 9시
   - 동작: 프로그램 시작
     - 프로그램: `python`
     - 인수: `C:\경로\hometax_auto_download.py`

4. **완료**

이제 매월 자동으로 실행됩니다!

### 4. 배치 파일 생성 (더블 클릭 실행용)

`run_hometax.bat` 파일 생성:

```batch
@echo off
cd /d %~dp0
python hometax_auto_download.py
pause
```

이제 `run_hometax.bat` 더블 클릭으로 실행 가능!

---

## 🔒 보안 주의사항

### ✅ 안전한 사용법:

1. **비밀번호 저장 안 함**
   - 스크립트는 인증서 비밀번호를 저장하지 않음
   - 매번 수동으로 입력

2. **개인 PC에서만 실행**
   - 공용 PC에서 사용 금지
   - 회사 PC에서만 사용 권장

3. **공인인증서 보관**
   - PC에 안전하게 보관
   - USB에 백업 권장

### ⚠️ 주의사항:

1. **타인 계정 사용 금지**
   - 본인 계정만 사용
   - 법적 문제 발생 가능

2. **과도한 요청 금지**
   - 하루 10회 이내 권장
   - 홈택스 차단 가능성

3. **비밀번호 하드코딩 금지**
   - 스크립트에 비밀번호 직접 입력 금지
   - 보안 위험

---

## 📞 문의 및 지원

### 오류 발생 시:

1. **오류 메시지 확인**
   - 콘솔 창의 오류 메시지 복사

2. **Chrome 버전 확인**
   ```
   Chrome 설정 → 정보
   ```

3. **Python 버전 확인**
   ```bash
   python --version
   ```

4. **Selenium 버전 확인**
   ```bash
   pip show selenium
   ```

5. **스크린샷**
   - 오류 화면 캡처

---

## 🎉 성공적인 실행 예시

```
==============================================================
🤖 홈택스 신고자료 자동 다운로드 시작
==============================================================

🔧 크롬 브라우저 설정 중...
✅ 크롬 브라우저 준비 완료!

🌐 홈택스 접속 중...
✅ 홈택스 접속 완료!

🔐 공인인증서 로그인 시작...
   ⏳ 로그인 페이지로 이동 중...
   ⏳ 공인인증서 로그인 버튼 찾는 중...

============================================================
👤 공인인증서를 선택하고 비밀번호를 입력해주세요.
⏳ 로그인 완료까지 최대 60초 대기합니다...
============================================================

   ⏱️ 남은 시간: 60초
   ⏱️ 남은 시간: 55초
✅ 로그인 완료!

📄 신고자료 메뉴로 이동 중...
   ⏳ 조회/발급 메뉴 찾는 중...
   ⏳ 신고자료조회 메뉴 찾는 중...
✅ 신고자료 페이지 이동 완료!

📥 2024년 2월 신고자료 다운로드 중...
   📅 조회 기간: 20240201 ~ 20240231
   ⏳ 조회 조건 설정 중...
   ⏳ 조회 버튼 클릭...
   ⏳ 다운로드 버튼 클릭...
   ⏳ 파일 다운로드 중... (최대 30초 대기)
✅ 다운로드 완료!

📁 파일 정리 중...
   ✅ 폴더 생성: 2024년02월_홈택스신고자료_20240209_143052
   📦 다운로드된 파일 2개 발견:
      ✅ 이동: 신고자료_202402.xlsx
      ✅ 이동: 부가세신고_202402.pdf

✅ 파일 정리 완료!
📂 저장 위치: D:/홈택스_신고자료/2024년02월_홈택스신고자료_20240209_143052

==============================================================
🎉 모든 작업이 완료되었습니다!
==============================================================

⏳ 5초 후 브라우저를 닫습니다...
✅ 브라우저 종료 완료
```

---

## 💡 팁 & 트릭

### 1. 빠른 실행

바탕화면에 바로가기 만들기:
- `hometax_auto_download.py` 우클릭
- "바로가기 만들기"
- 바탕화면으로 이동

### 2. 자동 입력

기본값을 항상 사용하려면:
- 스크립트 실행 시 Enter만 누르기
- 현재 월 자동 다운로드

### 3. 로그 기록

실행 내역을 파일로 저장하려면:
```bash
python hometax_auto_download.py > log.txt 2>&1
```

### 4. 다중 실행 방지

한 번에 하나만 실행하세요.
- 여러 개 실행 시 충돌 가능

---

## 📚 추가 자료

- **Selenium 공식 문서**: https://www.selenium.dev/documentation/
- **Python 공식 문서**: https://docs.python.org/ko/3/
- **홈택스 고객센터**: 126

---

**업데이트**: 2024-02-09  
**버전**: 1.0.0  
**작성자**: Atom Tax System

🎉 자동화로 업무 효율을 높이세요!
