<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë“œë¼ì´ë¸Œ ë””ë²„ê·¸</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        .debug-box {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 2px solid #ddd;
        }
        .success {
            background: #d4edda;
            border-color: #28a745;
        }
        .error {
            background: #f8d7da;
            border-color: #dc3545;
        }
        button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5568d3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }
        th {
            background: #667eea;
            color: white;
        }
        .test-link {
            color: #34a853;
            text-decoration: none;
            font-weight: bold;
        }
        .test-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>ğŸ” êµ¬ê¸€ ë“œë¼ì´ë¸Œ ë””ë²„ê·¸</h1>
    
    <div class="debug-box">
        <h3>1. ê¸ˆì•„ì‹¤ì—… ë°ì´í„° í™•ì¸</h3>
        <button onclick="checkClient()">ê¸ˆì•„ì‹¤ì—… ë°ì´í„° ì¡°íšŒ</button>
        <div id="clientData"></div>
    </div>

    <div class="debug-box">
        <h3>2. ì „ì²´ ê³ ê°ì‚¬ ë“œë¼ì´ë¸Œ URL í™•ì¸</h3>
        <button onclick="checkAllDrives()">ì „ì²´ ê³ ê°ì‚¬ ë“œë¼ì´ë¸Œ í™•ì¸</button>
        <div id="allDrives"></div>
    </div>

    <script>
        const API_BASE = '/api';

        async function checkClient() {
            const resultDiv = document.getElementById('clientData');
            resultDiv.innerHTML = '<p>ğŸ”„ ë¡œë”© ì¤‘...</p>';
            
            try {
                // Get all clients
                const response = await fetch(`${API_BASE}/tables/clients?limit=1000`);
                const result = await response.json();
                
                // Find ê¸ˆì•„ì‹¤ì—…
                const client = result.data.find(c => c.company_name && c.company_name.includes('ê¸ˆì•„ì‹¤ì—…'));
                
                if (client) {
                    const driveUrl = client.google_drive_folder || '';
                    const hasUrl = driveUrl.trim() !== '';
                    
                    resultDiv.innerHTML = `
                        <div class="${hasUrl ? 'success' : 'error'} debug-box">
                            <h4>âœ… ê¸ˆì•„ì‹¤ì—… ë°œê²¬!</h4>
                            <table>
                                <tr>
                                    <th>í•„ë“œ</th>
                                    <th>ê°’</th>
                                </tr>
                                <tr>
                                    <td>ID</td>
                                    <td>${client.id}</td>
                                </tr>
                                <tr>
                                    <td>ê±°ë˜ì²˜ëª…</td>
                                    <td>${client.company_name}</td>
                                </tr>
                                <tr>
                                    <td>êµ¬ê¸€ ë“œë¼ì´ë¸Œ URL (ê¸°ì¥)</td>
                                    <td>${driveUrl || 'âŒ ì—†ìŒ'}</td>
                                </tr>
                                <tr>
                                    <td>ë¶€ë™ì‚° ë“œë¼ì´ë¸Œ URL</td>
                                    <td>${client.real_estate_drive_folder || 'âŒ ì—†ìŒ'}</td>
                                </tr>
                                <tr>
                                    <td>URL ê¸¸ì´</td>
                                    <td>${driveUrl.length} ê¸€ì</td>
                                </tr>
                                <tr>
                                    <td>í…ŒìŠ¤íŠ¸ ë§í¬</td>
                                    <td>
                                        ${hasUrl ? `
                                            <a href="${driveUrl}" target="_blank" class="test-link">
                                                ğŸ”— í´ë¦­í•´ì„œ ì—´ê¸° í…ŒìŠ¤íŠ¸
                                            </a>
                                        ` : 'ë§í¬ ì—†ìŒ'}
                                    </td>
                                </tr>
                            </table>
                            
                            ${hasUrl ? `
                                <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 4px;">
                                    <strong>ğŸ“‹ URL ë¶„ì„:</strong><br>
                                    <code style="word-break: break-all;">${driveUrl}</code>
                                    <br><br>
                                    <strong>ê²€ì¦:</strong><br>
                                    âœ“ https:// ì‹œì‘? ${driveUrl.startsWith('https://') ? 'âœ…' : 'âŒ'}<br>
                                    âœ“ drive.google.com í¬í•¨? ${driveUrl.includes('drive.google.com') ? 'âœ…' : 'âŒ'}<br>
                                    âœ“ folders/ í¬í•¨? ${driveUrl.includes('folders/') ? 'âœ…' : 'âŒ'}
                                </div>
                            ` : ''}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error debug-box">
                            <h4>âŒ ê¸ˆì•„ì‹¤ì—…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h4>
                            <p>ë“±ë¡ëœ ê³ ê°ì‚¬ ìˆ˜: ${result.data.length}ê°œ</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error debug-box">
                        <h4>âŒ ì˜¤ë¥˜ ë°œìƒ</h4>
                        <pre>${error.message}</pre>
                    </div>
                `;
                console.error('Error:', error);
            }
        }

        async function checkAllDrives() {
            const resultDiv = document.getElementById('allDrives');
            resultDiv.innerHTML = '<p>ğŸ”„ ë¡œë”© ì¤‘...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/tables/clients?limit=1000`);
                const result = await response.json();
                
                const clientsWithDrive = result.data.filter(c => 
                    (c.google_drive_folder && c.google_drive_folder.trim() !== '') ||
                    (c.real_estate_drive_folder && c.real_estate_drive_folder.trim() !== '')
                );
                
                if (clientsWithDrive.length > 0) {
                    let html = `
                        <div class="success debug-box">
                            <h4>âœ… ë“œë¼ì´ë¸Œ URLì´ ìˆëŠ” ê³ ê°ì‚¬: ${clientsWithDrive.length}ê°œ</h4>
                            <table>
                                <thead>
                                    <tr>
                                        <th>ë²ˆí˜¸</th>
                                        <th>ê±°ë˜ì²˜ëª…</th>
                                        <th>ê¸°ì¥ URL</th>
                                        <th>ë¶€ë™ì‚° URL</th>
                                        <th>í…ŒìŠ¤íŠ¸</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    clientsWithDrive.forEach((client, index) => {
                        const driveUrl = client.google_drive_folder || '';
                        const realEstateUrl = client.real_estate_drive_folder || '';
                        const isValidDrive = driveUrl.startsWith('https://') && driveUrl.includes('drive.google.com');
                        const isValidRealEstate = realEstateUrl.startsWith('https://') && realEstateUrl.includes('drive.google.com');
                        
                        html += `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${client.company_name || '-'}</td>
                                <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                    ${driveUrl ? `<code>${driveUrl}</code>` : '-'}
                                </td>
                                <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                    ${realEstateUrl ? `<code>${realEstateUrl}</code>` : '-'}
                                </td>
                                <td>
                                    ${driveUrl ? `<a href="${driveUrl}" target="_blank" class="test-link" style="color: #34a853;">
                                        ${isValidDrive ? 'âœ… ê¸°ì¥' : 'âš ï¸ í™•ì¸'}
                                    </a>` : ''}
                                    ${realEstateUrl ? `<a href="${realEstateUrl}" target="_blank" class="test-link" style="color: #f59e0b; margin-left: 8px;">
                                        ${isValidRealEstate ? 'âœ… ë¶€ë™ì‚°' : 'âš ï¸ í™•ì¸'}
                                    </a>` : ''}
                                </td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error debug-box">
                            <h4>âŒ ë“œë¼ì´ë¸Œ URLì´ ë“±ë¡ëœ ê³ ê°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤</h4>
                            <p>ì „ì²´ ê³ ê°ì‚¬ ìˆ˜: ${result.data.length}ê°œ</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error debug-box">
                        <h4>âŒ ì˜¤ë¥˜ ë°œìƒ</h4>
                        <pre>${error.message}</pre>
                    </div>
                `;
                console.error('Error:', error);
            }
        }
    </script>
</body>
</html>
